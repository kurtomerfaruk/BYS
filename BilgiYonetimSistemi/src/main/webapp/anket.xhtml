<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="jakarta.faces.facelets"
      xmlns:h="jakarta.faces.html"
      xmlns:f="jakarta.faces.core"
      xmlns:p="primefaces"
      xmlns:pe="primefaces.extensions"
      dir="ltr"
      lang="tr"
      data-nav-layout="vertical" data-vertical-style="overlay" data-theme-mode="light" data-header-styles="light"
      data-menu-styles="light"
      data-width="compact"
      data-toggled="close">
<h:head>
    <meta charset="UTF-8"/>
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport"/>

    <f:facet name="first">
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <meta name="viewport"
              content="user-scalable=no,
                  width=device-width,
                  initial-scale=1.0,
                  maximum-scale=1.0"/>
    </f:facet>

    <title>#{messages.AppNameFull}</title>

    <!-- FAVICON -->
    <h:outputStylesheet library="images" name="brand-logos/favicon.ico"/>

    <!-- BOOTSTRAP CSS -->
    <h:outputStylesheet library="libs" name="bootstrap/css/bootstrap.min.css"/>

    <!-- STYLES CSS -->
    <h:outputStylesheet library="css" name="styles.css"/>

    <!-- ICONS CSS -->
    <h:outputStylesheet library="icon-fonts" name="icons.css"/>


    <!-- NODE WAVES CSS -->
    <h:outputStylesheet library="libs" name="node-waves/waves.min.css"/>

    <!-- SIMPLEBAR CSS -->
    <h:outputStylesheet library="libs" name="simplebar/simplebar.min.css"/>

    <!-- PICKER CSS -->
    <h:outputStylesheet library="libs" name="simplebar/simplebar.min.css"/>
    <h:outputStylesheet library="libs" name="flatpickr/flatpickr.min.css"/>
    <h:outputStylesheet library="libs" name="@simonwep/pickr/themes/nano.min.css"/>

    <!-- CHOICES CSS -->
    <h:outputStylesheet library="libs" name="choices.js/public/assets/styles/choices.min.css"/>

    <!-- CHOICES JS -->
    <h:outputScript library="libs" name="choices.js/public/assets/scripts/choices.min.js"/>
    <!-- MAIN JS -->
    <h:outputScript library="js" name="main.js"/>

    <h:outputStylesheet library="css" name="pfcrud.css"/>
</h:head>
<h:body>
    <p:growl id="growl" showDetail="false"/>

    <p:dialog appendTo="@(body)" modal="true" resizable="false" closable="false" header="T.C. Kimlik No Sorgulanıyor..."
              widgetVar="Loading">
        <div class="spinner">
            <div class="rect1"></div>
            <div class="rect2"></div>
            <div class="rect3"></div>
            <div class="rect4"></div>
            <div class="rect5"></div>
        </div>
    </p:dialog>
    <div class="page">
        <header class="app-header sticky" id="header">

            <!-- Start::main-header-container -->
            <div class="main-header-container container-fluid">

                <!-- Start::header-content-left -->
                <div class="header-content-left">

                    <!-- Start::header-element -->
                    <div class="header-element">
                        <div class="horizontal-logo">
                            <a href="#" class="header-logo">
                                <h:graphicImage library="images" name="gbb_logo_new.png" alt="logo" styleClass="desktop-logo"/>
                                <h:graphicImage library="images" name="gbb_logo_new.png" alt="logo" styleClass="toggle-logo"/>
                                <h:graphicImage library="images" name="gbb_logo_new.png" alt="logo" styleClass="desktop-dark"/>
                                <h:graphicImage library="images" name="gbb_logo_new.png" alt="logo" styleClass="toggle-dark"/>
                            </a>
                        </div>
                    </div>
                    <!-- End::header-element -->


                </div>
                <!-- End::header-content-left -->

                <!-- Start::header-content-right -->
                <ul class="header-content-right">

                    <!-- Start::header-element -->
                    <li class="header-element d-md-none d-block">
                        <a href="javascript:void(0);" class="header-link" data-bs-toggle="modal" data-bs-target="#header-responsive-search">
                            <!-- Start::header-link-icon -->
                            <i class="bi bi-search header-link-icon"></i>
                            <!-- End::header-link-icon -->
                        </a>
                    </li>
                    <!-- End::header-element -->


                    <ui:fragment rendered="#{surveyPublicController.gnlAnket.anketTuru.name() eq 'GENEL'}">
                        <!-- Start::header-element -->
                        <li class="header-element dropdown">

                            <div class="d-flex align-items-center">
                                <div class="d-xl-block d-none lh-1">
                                        <span class="fw-medium lh-1">
                                            <ui:fragment rendered="#{syKullanici == null}">
                                                <button type="button" class="btn btn-primary btn-wave waves-effect waves-light"
                                                        onclick="PF('girisYapDialog').show()">
                                                    <i class="ri-login-box-line"></i> Giriş Yap
                                                </button>
                                            </ui:fragment>
                                            <ui:fragment rendered="#{syKullanici != null}">
                                                <a href="javascript:void(0);" class="header-link dropdown-toggle show" id="mainHeaderProfile"
                                                   data-bs-toggle="dropdown" data-bs-auto-close="outside" aria-expanded="true">
                                                    <div class="d-flex align-items-center">
                                                        <div class="d-xl-block d-none lh-1">
                                                            <span class="fw-medium lh-1">#{syKullanici.gnlPersonel.gnlKisi.adSoyad}</span>
                                                        </div>
                                                    </div>
                                                </a>
                                                 <ul class="main-header-dropdown dropdown-menu pt-0 overflow-hidden header-profile-dropdown dropdown-menu-end"
                                                     aria-labelledby="mainHeaderProfile">
                                                     <li>
                                                        <div class="py-2 px-3 text-center">
                                                            <span class="fw-semibold"> #{syKullanici.gnlPersonel.gnlKisi.adSoyad} </span>
                                                            <span class="d-block fs-12 text-muted">#{syKullanici.gnlPersonel.gnlUnvan.tanim}</span>
                                                        </div>
                                                     </li>
                                                     <li class="py-2 px-3">
                                                        <h:form>
                                                            <p:commandLink styleClass="btn btn-primary btn-sm w-100"
                                                                           actionListener="#{loginController.logout()}" update="@none"
                                                                           oncomplete="if(args.loggedOut){ location.reload(); }">
                                                                #{messages.buttonCikisYap}
                                                                <f:param name="surveyLogin" value="#{true}"/>
                                                            </p:commandLink>
                                                        </h:form>
                                                    </li>
                                                 </ul>
                                            </ui:fragment>
                                        </span>
                                </div>
                            </div>
                        </li>
                        <!-- End::header-element -->
                    </ui:fragment>


                </ul>
                <!-- End::header-content-right -->

            </div>
            <!-- End::main-header-container -->

        </header>
        <div class="main-content app-content" style="margin-inline-start:0px !important;">
            <div class="container-fluid1">
                <h:form id="fillForm">


                    <pe:tooltip/>

                    <div class="m-3">
                        <div class="d-flex justify-content-center">
                            <div class="p-4 bg-light" style="min-width:400px; max-width:600px;">
                                <ui:fragment rendered="#{empty surveyPublicController.gnlAnket}">
                                    <div class="alert alert-secondary" role="alert">
                                        <h1 class="display-5 text-center">Erişmek istediğiniz anket kullanımda değil</h1>
                                    </div>
                                </ui:fragment>
                                <ui:fragment rendered="#{not empty surveyPublicController.gnlAnket}">
                                    <ui:fragment rendered="#{surveyPublicController.gnlAnket.anketTuru.name() eq 'KULLANICI'}">
                                        <div class="alert alert-solid-secondary alert-dismissible fade show" role="alert">
                                            <h3 class="text-center text-white">Anketi tamamlamak için kullanıcı girişi yapmanız gerekir!!!</h3>
                                        </div>
                                    </ui:fragment>
                                    <ui:fragment rendered="#{surveyPublicController.gnlAnket.anketTuru.name() eq 'KISI'}">
                                        <div class="alert alert-solid-secondary alert-dismissible fade show" role="alert">
                                            <h3 class="text-center text-white">Anketi tamamlamak için T.C. Kimlik No ve Doğum Tarihi girişi yapmanız gerekir!!!</h3>
                                        </div>
                                    </ui:fragment>
                                    <ui:fragment rendered="#{surveyPublicController.gnlAnket.anketTuru.name() eq 'GENEL'}">
                                        <div class="alert alert-solid-primary alert-dismissible fade show">
                                            <h3 class="text-center text-white">Bu anket için herhangi bir kişisel veri toplanmayacaktır.</h3>
                                        </div>
                                    </ui:fragment>

                                    <div class="card custom-card">
                                        <div class="card-body">
                                            <div class="p-3 bg-primary border border-bottom-0">
                                                <h5 class="fw-medium mb-0 d-flex align-items-center text-white">#{surveyPublicController.gnlAnket.baslik}</h5>
                                            </div>
                                            <div class="p-3 border">
                                                <div class="d-flex align-items-center flex-wrap gap-3 mb-4">
                                                    <p:outputLabel value="#{surveyPublicController.gnlAnket.aciklama}" escape="false"
                                                                   styleClass="mb-0 flex-grow-1"/>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card-footer">
                                            <div style="color: red">
                                                * Zorunlu soruyu belirtir
                                            </div>
                                        </div>
                                    </div>

                                    <ui:fragment rendered="#{surveyPublicController.gnlAnket.anketTuru.name() eq 'KISI'}">
                                        <div class="card custom-card">
                                            <div class="card-body">
                                                <p:panelGrid columns="2">
                                                    <p:outputLabel value="#{messages.dogumTarihiLabel}" for="@next"/>
                                                    <p:datePicker id="dogumTarihi" value="#{surveyPublicController.gnlKisi.dogumTarihi}"
                                                                  label="#{messages.dogumTarihiText}"
                                                                  title="#{messages.dogumTarihiText}" mask="true" required="true"
                                                                  pattern="#{messages.tarihFormat}" monthNavigator="true"
                                                                  yearNavigator="true" showIcon="true" showButtonBar="true" showOnFocus="false"
                                                                  style="width: 100% !important;" styleClass="datePicker"/>

                                                    <p:outputLabel value="#{messages.tcKimlikNoLabel}" for="tcKimlikNo"/>
                                                    <h:panelGroup>
                                                        <div class="ui-inputgroup">
                                                            <p:inputMask id="tcKimlikNo"
                                                                         value="#{surveyPublicController.gnlKisi.tcKimlikNo}" label="#{messages.tcKimlikNoText}"
                                                                         required="true"
                                                                         title="#{messages.tcKimlikNoText}" mask="99999999999"
                                                                         style="min-width: 150px !important;"/>
                                                            <p:commandButton icon="pi pi-search"
                                                                             process="@this,tcKimlikNo,dogumTarihi,:growl"
                                                                             ajax="true"
                                                                             update=":growl,@(.tcUpdate),tcKimlikNo,dogumTarihi"
                                                                             actionListener="#{surveyPublicController.getTcKimlik()}"
                                                                             onstart="PF('Loading').show()" oncomplete="PF('Loading').hide()"
                                                                             styleClass="btn-xs btn btn-info"/>
                                                        </div>
                                                    </h:panelGroup>

                                                    <p:outputLabel value="#{messages.adLabel}" for="@next"/>
                                                    <p:inputText id="ad" value="#{surveyPublicController.gnlKisi.ad}"
                                                                 title="#{messages.adText}" styleClass="tcUpdate" size="50"/>

                                                    <p:outputLabel value="#{messages.soyadLabel}" for="@next"/>
                                                    <p:inputText id="soyad" value="#{surveyPublicController.gnlKisi.soyad}"
                                                                 title="#{messages.soyadText}"
                                                                 styleClass="tcUpdate"/>
                                                </p:panelGrid>
                                            </div>
                                        </div>
                                    </ui:fragment>

                                    <ui:repeat value="#{surveyPublicController.gnlAnket.gnlAnketSoruList}" var="q">
                                        <div class="card custom-card">
                                            <div class="card-header">
                                                <div class="card-title">
                                                    #{q.tanim}
                                                    <h:outputText value="*" rendered="#{q.zorunlu}" style="color: red"/>
                                                </div>
                                            </div>
                                            <div class="card-body">
                                                <p:inputText rendered="#{q.soruTuru.name() eq 'TEXT'}"
                                                             value="#{surveyPublicController.answers[q.id]}" label="#{q.tanim}"
                                                             required="#{q.zorunlu}"/>

                                                <ui:fragment rendered="#{q.soruTuru.name() eq 'SELECT_ONE'}">
                                                    <p:selectOneRadio value="#{surveyPublicController.answers[q.id]}"
                                                                      layout="custom" label="#{q.tanim}"
                                                                      required="#{q.zorunlu}">

                                                        <f:selectItems value="#{q.gnlAnketSoruSecenekList}" var="o"
                                                                       itemLabel="#{o.tanim}" itemValue="#{o.id}"/>
                                                        <f:selectItem itemValue="OTHER" itemLabel="Diğer"/>
                                                        <p:ajax event="change" update="@parent"/>
                                                    </p:selectOneRadio>

                                                    <ui:repeat value="#{q.gnlAnketSoruSecenekList}" var="o" varStatus="optionStatus">
                                                        <p:radioButton for="@parent:@previous" itemIndex="#{optionStatus.index}"/>
                                                        <p:outputLabel for="@previous" value=" #{o.tanim}" styleClass="p-1"/>
                                                        <br/>
                                                    </ui:repeat>

                                                    <h:panelGroup rendered="#{q.diger}">
                                                        <p:radioButton for="@parent:@previous:@previous" itemIndex="#{q.gnlAnketSoruSecenekList.size()}"
                                                                       styleClass="mb-1"/>
                                                        <p:outputLabel for="@previous" value="Diğer: " styleClass="p-1"/>
                                                        <p:inputText value="#{surveyPublicController.otherAnswers[q.id]}" style="width:85% !important"
                                                                     label="#{q.tanim} Diğer"
                                                                     required="#{surveyPublicController.answers[q.id] eq 'OTHER'}"/>
                                                    </h:panelGroup>


                                                </ui:fragment>

                                                <ui:fragment rendered="#{q.soruTuru.name() eq 'SELECT_MANY'}">
                                                    <p:selectManyCheckbox value="#{surveyPublicController.answers[q.id]}"
                                                                          required="#{q.zorunlu}"
                                                                          layout="custom" label="#{q.tanim}">
                                                        <f:selectItems value="#{q.gnlAnketSoruSecenekList}" var="o"
                                                                       itemLabel="#{o.tanim}" itemValue="#{o.id}"/>
                                                        <f:selectItem itemValue="OTHER" itemLabel="Diğer"/>
                                                        <p:ajax event="change" update="@parent" listener="#{surveyPublicController.deneme(q.id)}"/>

                                                    </p:selectManyCheckbox>

                                                    <!-- Normal seçenekler -->
                                                    <ui:repeat value="#{q.gnlAnketSoruSecenekList}" var="o" varStatus="vs">
                                                        <p:checkbox for="@parent:@previous" itemIndex="#{vs.index}" styleClass="mb-1"/>
                                                        <p:outputLabel for="@previous" value=" #{o.tanim}" style="padding-left:10px"/>
                                                        <br/>
                                                    </ui:repeat>

                                                    <!-- Diğer seçeneği -->
                                                    <h:panelGroup rendered="#{q.diger}">
                                                        <p:checkbox for="@parent:@previous:@previous" itemIndex="#{q.gnlAnketSoruSecenekList.size()}"
                                                                    styleClass="mb-1"/>
                                                        <p:outputLabel for="@previous" value="Diğer:" style="padding-left: 10px"/>
                                                        <p:inputText value="#{surveyPublicController.otherAnswers[q.id]}"
                                                                     style="margin-left:5px;width:85% !important"
                                                                     label="#{q.tanim} Diğer" required="#{surveyPublicController.isOtherSelected(q.id)}"/>
                                                    </h:panelGroup>
                                                </ui:fragment>
                                            </div>
                                        </div>
                                    </ui:repeat>

                                    <div class="card custom-card">

                                        <div class="card-footer">
                                            <div class="float-end">
                                                <p:commandButton icon="pi pi-check" styleClass="ui-button-success" value="Anketi Kaydet" update="@form,:growl"
                                                                 actionListener="#{surveyPublicController.submitAnswers()}"/>
                                            </div>
                                        </div>
                                    </div>

                                </ui:fragment>
                            </div>
                        </div>
                    </div>


                </h:form>

                <p:dialog widgetVar="girisYapDialog" modal="true" draggable="false" resizable="false" header="Giriş Yap" appendTo="@(body)" responsive="true"
                          closable="false">
                    <h:form id="GirisYapForm">
                        <div class="card custom-card shadow-none my-auto">
                            <div class="card-body p-5">
                                <p class="h4 fw-semibold mb-0 text-center">#{messages.AppNameFull}</p>
                                <p class="mb-0 text-muted fw-normal text-center">Giriş yapmak için kullanıcı bilgilerini giriniz...</p>
                                <p></p>
                                <div class="row gy-3">
                                    <div class="col-xl-12">
                                        <label class="form-label text-default"
                                               for="kullaniciAdi">#{messages.kullaniciAdiText}</label>
                                        <div class="position-relative">
                                            <p:inputText id="kullaniciAdi" styleClass="form-control"
                                                         value="#{loginController.kullaniciAdi}" required="true"
                                                         label="#{messages.kullaniciAdiText}"/>
                                        </div>
                                    </div>
                                    <div class="col-xl-12 mb-2">
                                        <label for="password"
                                               class="form-label text-default d-block">#{messages.parolaText}</label>
                                        <div class="position-relative">
                                            <p:password id="password" value="#{loginController.parola}"
                                                        required="true"
                                                        styleClass="form-control"
                                                        label="#{messages.parolaText}"/>
                                            <a href="javascript:void(0);"
                                               class="show-password-button text-muted" tabindex="-1"
                                               style="height: 40px;margin-top: -5px;margin-right: -5px"
                                               onclick="createpassword('password',this)" id="button-addon2">
                                                <i class="ri-eye-off-line align-middle"></i>
                                            </a>
                                        </div>
                                    </div>

                                    <div class="col-xl-12 mb-2">

                                        <div class="ui-inputgroup w-100">
                                            <h:graphicImage id="captchaImg" value="/captcha" alt="CAPTCHA Image"
                                                            styleClass="text-center" tabindex="-1"/>
                                            <div class="ui-inputgroup-addon">
                                                <p:commandButton icon="pi pi-refresh" type="button" tabindex="-1"
                                                                 onclick="document.getElementById('GirisYapForm:captchaImg').src='#{request.contextPath}/captcha?ts=' + new Date().getTime();"/>
                                            </div>
                                        </div>
                                        <p:inputText id="captchaInput" value="#{loginController.captchaInput}"
                                                     styleClass="form-control" required="true"
                                                     label="Doğrulama Kodu"/>
                                    </div>
                                </div>
                                <div class="d-grid mt-2 mb-2">
                                    <p:defaultCommand target="loginButton"/>
                                    <p:commandLink ajax="true" id="loginButton"
                                                   styleClass="btn btn-primary btn-lg"
                                                   action="#{loginController.login}"
                                                   update="growl"
                                                   oncomplete="if (!args.validationFailed){location.reload();}">
                                        <h:outputText style="color: #ffffff" value="#{messages.buttonGirisYap}"/>
                                        <f:param name="surveyLogin" value="#{true}"/>
                                    </p:commandLink>
                                </div>
                                <div class="d-flex align-items-center justify-content-between mb-2">
                                    <div class="flex-grow-1">
                                        <div class="d-flex align-items-center gap-2 card-style-6-avatar">
                                            <h6 class="fs-12 mb-0 fw-semibold">Versiyon</h6>
                                        </div>
                                    </div>
                                    <div class="min-w-fit-content">
                                        <div class="d-flex gap-2">
                                            <span class="badge bg-success">#{initApp.version}</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="d-flex align-items-center justify-content-between mb-2">
                                    <div class="flex-grow-1">
                                        <div class="d-flex align-items-center gap-2 card-style-6-avatar">
                                            <h6 class="fs-12 mb-0 fw-semibold">Oluşturulma Zamanı</h6>
                                        </div>
                                    </div>
                                    <div class="min-w-fit-content">
                                        <div class="d-flex gap-2">
                                            <span class="badge bg-success">#{initApp.buildTime}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </h:form>
                </p:dialog>
            </div>
        </div>

    </div>

    <!-- SCRIPTS -->
    <h:outputScript library="primefaces" name="jquery/jquery.js"/>

    <!-- POPPER JS -->
    <h:outputScript library="libs" name="@popperjs/core/umd/popper.min.js"/>

    <!-- BOOTSTRAP JS -->
    <h:outputScript library="libs" name="bootstrap/js/bootstrap.bundle.min.js"/>

    <!-- NODE WAVES JS -->
    <h:outputScript library="libs" name="node-waves/waves.min.js"/>


    <!-- END SCRIPTS -->
    <h:outputScript library="js" name="pfcrud.js"/>
    <h:outputScript library="primefaces" name="locales/locale-tr.js"/>


    <!-- END SCRIPTS -->
</h:body>
</html>
