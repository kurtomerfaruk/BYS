<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="jakarta.faces.facelets"
      xmlns:h="jakarta.faces.html"
      xmlns:p="primefaces"
      xmlns:pe="primefaces.extensions">

<ui:composition>
    <p:dialog widgetVar="PrescriptionDialog"
              modal="true"
              resizable="false"
              closeOnEscape="true"
              header="Rapor / Reçete"
              appendTo="@(body)"
              responsive="true"
              onShow="PF('PrescriptionDialog').initPosition();"
              fitViewport="true"
              position="top"
              style="max-width:50% !important">

        <h:form id="PrescriptionForm" enctype="multipart/form-data">
            <p:panelGrid columns="1" class="w-100" id="dosyaPanel" rendered="#{ortBasvuruController.selected !=null}" layout="tabular">

                <p:fileUpload id="upload"
                              mode="advanced"
                              dragDropSupport="false"
                              cancelLabel="#{messages.buttonIptal}"
                              uploadLabel="#{messages.buttonYukle}"
                              label="#{messages.buttonSec}"
                              invalidFileMessage="#{messages.hataliDosyaTipi}"
                              invalidSizeMessage="#{messages.hataliDosyaBoyutu}"
                              listener="#{ortBasvuruDosyaController.handleFileUpload}"
                              multiple="false"
                              update=":growl,dosyaID"
                              fileLimit="5"
                              allowTypes="/(\.|\/)(gif|jpe?g|png|jpg|pdf|xls|xlsx|doc|docx)$/">
                    <p:validateFile sizeLimit="10000000"/>
                </p:fileUpload>

                <p:dataTable id="dosyaID"
                             value="#{ortBasvuruController.selected.ortBasvuruDosyaList}"
                             var="dosyaItem"
                             style="width: auto"
                             emptyMessage="#{messages.kayitBulunamadi}"
                             paginator="true"
                             rows="5"
                             paginatorPosition="bottom">

                    <p:column>
                        #{dosyaItem.dosyaAdi}
                    </p:column>

                    <p:column width="60" headerText="#{messages.buttonIndir}">
                        <p:commandButton icon="pi pi-download"
                                         title="#{messages.buttonIndir}"
                                         actionListener="#{ortBasvuruDosyaController.setSelectedDosya(dosyaItem)}"
                                         ajax="false"
                                         update="dosyaID">
                            <p:fileDownload value="#{ortBasvuruDosyaController.download}"/>
                        </p:commandButton>
                    </p:column>

                    <p:column width="60" headerText="#{messages.buttonOnizle}">
                        <p:commandButton icon="pi pi-search"
                                         title="#{messages.buttonOnizle}"
                                         actionListener="#{imageController.getOrtBasvuruDosyaImage(dosyaItem)}"
                                         update="PrescriptionForm:formResim,:growl"
                                         rendered="#{ortBasvuruController.isImage(dosyaItem.dosyaYolu)}"
                                         oncomplete="PF('dialogResim').show()">
                        </p:commandButton>
                    </p:column>

                    <p:column width="60" headerText="PDF">
                        <p:commandButton icon="pi pi-search"
                                         title="#{messages.buttonOnizle}"
                                         update="formPdf,:growl"
                                         actionListener="#{pdfController.getOrtBasvuruDosyaPdf(dosyaItem)}"
                                         rendered="#{ortBasvuruController.isPdf(dosyaItem.dosyaYolu)}"
                                         oncomplete="PF('dialogPdf').show()">
                        </p:commandButton>
                    </p:column>

                    <p:column width="60" headerText="#{messages.buttonSil}">
                        <p:commandButton icon="pi pi-trash"
                                         title="#{messages.buttonSil}"
                                         actionListener="#{ortBasvuruDosyaController.deleteFile(dosyaItem)}"
                                         update="dosyaID,:growl"
                                         process="dosyaID"/>
                    </p:column>

                </p:dataTable>

            </p:panelGrid>
        </h:form>

    </p:dialog>

    <p:dialog id="dlgPdf" header="PDF" widgetVar="dialogPdf" position="top" modal="true" appendTo="@(body)" closeOnEscape="true"
              onShow="PF('dialogPdf').initPosition();PF('dialogPdf').toggleMaximize();resizeViewer();" onHide="PF('dialogPdf').toggleMaximize();"
              responsive="true" style="overflow:auto;"
              fitViewport="true">
        <script type="text/javascript">
            function resizeViewer() {
                var windowH = $(window).height();
                windowH -= 150;
                // var windowW = $(window).width();
                $("#formPdf\\:viewer").css("height", windowH + "px");
                // $("#formPdf\\:viewer").css("width", windowW + "px");
                // console.log("width:" + $("#formPdf\\:viewer").width())
                // console.log("height:" + $("#formPdf\\:viewer").height())
            }
        </script>
        <h:form id="formPdf" styleClass="w-100">
            <pe:documentViewer id="viewer" height="100%" value="#{pdfController.content}" download="Rapor.pdf" zoom="auto" transient="true"/>
        </h:form>
    </p:dialog>

    <p:dialog id="dlgResim" header="Dosya Detayı" widgetVar="dialogResim" position="top" maximizable="true" modal="true"
              appendTo="@(body)" closeOnEscape="true"
              onShow="PF('dialogResim').initPosition();"
              responsive="true"
              style="overflow: auto;width: 500px">
        <h:form id="formResim" styleClass="w-100">
            <p:commandButton id="zoomin" icon="ui-icon-zoomin" value="Büyüt +" style="float: left"
                             onclick="PF('rotateAndResizeWidget').scale(1.25);return false;"/>
            <p:commandButton icon="ui-icon-zoomout" value="Küçült -" style="float: left"
                             onclick="PF('rotateAndResizeWidget').scale(0.75);return false;"/>

            <p:graphicImage id="images" value="#{imageController.preview}" style="height: 500px !important; width: 500px !important;"/>

            <pe:imageRotateAndResize id="rotateAndResize" for="images" widgetVar="rotateAndResizeWidget">
            </pe:imageRotateAndResize>

        </h:form>

    </p:dialog>

</ui:composition>

</html>
