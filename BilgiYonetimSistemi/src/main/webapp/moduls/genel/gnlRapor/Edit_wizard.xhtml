<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="jakarta.faces.facelets"
      xmlns:h="jakarta.faces.html"
      xmlns:f="jakarta.faces.core"
      xmlns:p="primefaces">
<h:head>

    <style type="text/css">
        .main-panel {
            margin: 20px;
            padding: 20px;
        }
        .dialog-xl {
            width: 95% !important;
            height: 95% !important;
            max-width: 1400px;
            max-height: 800px;
        }
        .tab-panel {
            padding: 15px;
        }
        .form-grid {
            margin-bottom: 20px;
        }
        .data-table {
            margin-top: 10px;
        }
        .button-small {
            padding: 3px 8px !important;
            font-size: 12px !important;
        }
        .section-header {
            background-color: #f5f5f5;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .entity-box {
            border: 1px solid #ddd;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
    </style>
</h:head>
<h:body>

    <p:dialog widgetVar="GnlRaporEditDialog"
              id="GnlRaporEditDlg"
              modal="true"
              resizable="false"
              closeOnEscape="true"
              header="#{messages.dialogKayitGuncelle}"
              appendTo="@(body)"
              responsive="true"
              onShow="PF('GnlRaporEditDialog').initPosition();adjustMenuWidth();"
              fitViewport="true"
              position="top">

        <h:form id="GnlRaporEditForm">

            <!-- WIZARD/TAB YAPISI -->
            <p:wizard flowListener="#{gnlRaporController.onWizardFlow}"  nextLabel="İleri" backLabel="Geri">

                <!-- ADIM 1: TEMEL BİLGİLER -->
                <p:tab title="1. Rapor Tanımı" titleStyle="font-weight:bold">

                    <ui:include src="/moduls/genel/gnlRapor/RaporTanimiTab.xhtml"/>

                </p:tab>

                <!-- ADIM 2: KOLON TANIMLARI -->
                <p:tab title="2. Kolon Tanımları" titleStyle="font-weight:bold">
                    <ui:include src="/moduls/genel/gnlRapor/KolonTab.xhtml"/>

                </p:tab>

                <!-- ADIM 3: PARAMETRE TANIMLARI -->
                <p:tab title="3. Parametre Tanımları" titleStyle="font-weight:bold">

                    <div class="tab-panel">
                        <h3 style="color: #2c3e50; margin-bottom: 20px;">
                            <i class="pi pi-sliders-h"></i> Rapor Parametreleri
                        </h3>

                        <!-- YENİ PARAMETRE EKLEME -->
                        <p:panel header="Yeni Parametre Ekle" toggleable="true" collapsed="true">

                            <p:panelGrid columns="3" style="width: 100%">

                                <p:outputLabel for="paramAdi" value="Parametre Adı *"/>
                                <p:inputText id="paramAdi"
                                             value="#{raporYonetimController.yeniParametre.parametreAdi}"
                                             placeholder="Ör: ad, baslangic_tarihi"
                                             style="width: 200px"/>

                                <p:outputLabel for="paramGorunurAdi" value="Görünür Ad"/>
                                <p:inputText id="paramGorunurAdi"
                                             value="#{raporYonetimController.yeniParametre.gorunurAdi}"
                                             placeholder="Ör: Ad, Başlangıç Tarihi"
                                             style="width: 200px"/>

                                <p:outputLabel for="paramTipi" value="Parametre Tipi"/>
                                <p:selectOneMenu id="paramTipi"
                                                 value="#{raporYonetimController.yeniParametre.veriTipi}"
                                                 style="width: 150px">
                                    <f:selectItem itemLabel="Seçiniz" itemValue=""/>
                                    <f:selectItems value="#{raporYonetimController.parametreTipleri}"/>
                                </p:selectOneMenu>

                                <p:outputLabel for="paramZorunlu" value="Zorunlu"/>
                                <p:selectBooleanCheckbox id="paramZorunlu"
                                                         value="#{raporYonetimController.yeniParametre.zorunlu}"/>

                                <p:outputLabel for="paramSiralama" value="Sıralama"/>
                                <p:spinner id="paramSiralama"
                                           value="#{raporYonetimController.yeniParametre.siralama}"
                                           min="1" max="100"
                                           style="width: 80px"/>

                                <p:outputLabel for="paramSqlKosul" value="SQL Koşul Örneği"/>
                                <p:inputText id="paramSqlKosul"
                                             value="#{raporYonetimController.yeniParametre.sqlKosul}"
                                             placeholder="Ör: e.ad LIKE :param"
                                             style="width: 300px"/>

                            </p:panelGrid>

                            <div style="text-align: center; margin-top: 15px;">
                                <p:commandButton value="Parametre Ekle"
                                                 action="#{raporYonetimController.yeniParametreEkle}"
                                                 update="parametreTable ,:growl"
                                                 process="@this"
                                                 icon="pi pi-plus"
                                                 styleClass="ui-button-success"/>
                            </div>

                        </p:panel>

                        <!-- PARAMETRE LİSTESİ -->
                        <div class="section-header">
                            <i class="pi pi-list"></i> Tanımlı Parametreler (#{raporYonetimController.yeniParametreler.size()})
                        </div>

                        <p:dataTable id="parametreTable"
                                     value="#{raporYonetimController.yeniParametreler}"
                                     var="parameter"
                                     emptyMessage="Henüz parametre tanımlanmamış"
                                     styleClass="data-table">

                            <p:column headerText="Parametre Adı">
                                <strong>#{parameter.parametreAdi}</strong>
                            </p:column>

                            <p:column headerText="Görünür Ad">
                                #{parameter.gorunurAdi}
                            </p:column>

                            <p:column headerText="Tip" width="120">
                                <p:tag value="#{param.veriTipi}"
                                       severity="info"/>
                            </p:column>

                            <p:column headerText="Zorunlu" width="100">
                                <p:selectBooleanCheckbox value="#{parameter.zorunlu}" disabled="true"/>
                            </p:column>

                            <p:column headerText="Sıra" width="70">
                                #{parameter.siralama}
                            </p:column>

                            <p:column headerText="SQL Koşul">
                                <small><code>#{parameter.sqlKosul}</code></small>
                            </p:column>

                            <p:column headerText="İşlemler" width="100">
                                <p:commandButton icon="pi pi-trash"
                                                 title="Sil"
                                                 action="#{raporYonetimController.parametreSil(parameter)}"
                                                 update="parametreTable ,:growl"
                                                 styleClass="ui-button-danger button-small"/>
                            </p:column>

                        </p:dataTable>

                        <div style="margin-top: 30px; text-align: center;">
                            <p:commandButton value="← Geri"
                                             icon="pi pi-arrow-left"
                                             update="@form"
                                             oncomplete="PF('wizard').prev()"
                                             styleClass="ui-button-secondary"/>

                            <p:commandButton value="İleri: Entity Bağlantıları →"
                                             icon="pi pi-arrow-right"
                                             update="@form"
                                             oncomplete="PF('wizard').next()"
                                             styleClass="ui-button-primary"/>
                        </div>

                    </div>

                </p:tab>

                <!-- ADIM 4: ENTITY BAĞLANTILARI -->
                <p:tab title="4. Entity Bağlantıları" titleStyle="font-weight:bold">

                    <div class="tab-panel">
                        <h3 style="color: #2c3e50; margin-bottom: 20px;">
                            <i class="pi pi-sitemap"></i> Entity Join Bağlantıları
                        </h3>

                        <!-- YENİ ENTITY BAĞLANTISI EKLE -->
                        <p:panel header="Yeni Entity Bağlantısı Ekle" toggleable="true" collapsed="true">

                            <p:panelGrid columns="2" style="width: 100%">

                                <p:outputLabel for="entityClass" value="Entity Class *"/>
                                <p:inputText id="entityClass"
                                             value="#{raporYonetimController.yeniEntityBaglanti.entityClass}"
                                             placeholder="Ör: com.proje.model.MoralEvleri"
                                             style="width: 400px"/>

                                <p:outputLabel for="entityAdi" value="Entity Adı"/>
                                <p:inputText id="entityAdi"
                                             value="#{raporYonetimController.yeniEntityBaglanti.entityAdi}"
                                             placeholder="Ör: MoralEvleri"
                                             style="width: 200px"/>

                                <p:outputLabel for="joinKosulu" value="Join Koşulu *"/>
                                <p:inputText id="joinKosulu"
                                             value="#{raporYonetimController.yeniEntityBaglanti.joinKosulu}"
                                             placeholder="Ör: kisiler.id = kisiMoralEvi.kisiId"
                                             style="width: 400px"/>

                                <p:outputLabel for="joinTipi" value="Join Tipi"/>
                                <p:selectOneMenu id="joinTipi"
                                                 value="#{raporYonetimController.yeniEntityBaglanti.joinTipi}"
                                                 style="width: 150px">
                                    <f:selectItem itemLabel="Seçiniz" itemValue=""/>
                                    <f:selectItems value="#{raporYonetimController.joinTipleri}"
                                                   var="tip"
                                                   itemLabel="#{tip}"
                                                   itemValue="#{tip}"/>
                                </p:selectOneMenu>

                                <p:outputLabel for="entitySiralama" value="Sıralama"/>
                                <p:spinner id="entitySiralama"
                                           value="#{raporYonetimController.yeniEntityBaglanti.siralama}"
                                           min="1" max="100"
                                           style="width: 80px"/>

                            </p:panelGrid>

                            <div style="text-align: center; margin-top: 15px;">
                                <p:commandButton value="Entity Bağlantısı Ekle"
                                                 action="#{raporYonetimController.yeniEntityBaglantiEkle}"
                                                 update="entityTable ,:growl"
                                                 process="@this"
                                                 icon="pi pi-plus"
                                                 styleClass="ui-button-success"/>
                            </div>

                        </p:panel>

                        <!-- ENTITY BAĞLANTI LİSTESİ -->
                        <div class="section-header">
                            <i class="pi pi-list"></i> Tanımlı Entity Bağlantıları (#{raporYonetimController.yeniEntityBaglantilari.size()})
                        </div>

                        <p:dataTable id="entityTable"
                                     value="#{raporYonetimController.yeniEntityBaglantilari}"
                                     var="baglanti"
                                     emptyMessage="Henüz entity bağlantısı tanımlanmamış"
                                     styleClass="data-table">

                            <p:column headerText="Entity Adı">
                                <strong>#{baglanti.entityAdi}</strong>
                            </p:column>

                            <p:column headerText="Entity Class">
                                <code>#{baglanti.entityClass}</code>
                            </p:column>

                            <p:column headerText="Join Koşulu">
                                <small><code>#{baglanti.joinKosulu}</code></small>
                            </p:column>

                            <p:column headerText="Join Tipi" width="100">
                                <p:tag value="#{baglanti.joinTipi}"
                                       severity="#{baglanti.joinTipi == 'INNER' ? 'danger' : 'warning'}"/>
                            </p:column>

                            <p:column headerText="Sıra" width="70">
                                #{baglanti.siralama}
                            </p:column>

                            <p:column headerText="İşlemler" width="100">
                                <p:commandButton icon="pi pi-trash"
                                                 title="Sil"
                                                 action="#{raporYonetimController.entityBaglantiSil(baglanti)}"
                                                 update="entityTable ,:growl"
                                                 styleClass="ui-button-danger button-small"/>
                            </p:column>

                        </p:dataTable>

                        <div style="margin-top: 30px; text-align: center;">
                            <p:commandButton value="← Geri"
                                             icon="pi pi-arrow-left"
                                             update="@form"
                                             oncomplete="PF('wizard').prev()"
                                             styleClass="ui-button-secondary"/>

                            <p:commandButton value="Özet ve Kaydet"
                                             icon="pi pi-check"
                                             update="@form"
                                             oncomplete="PF('wizard').next()"
                                             styleClass="ui-button-success"/>
                        </div>

                    </div>

                </p:tab>

                <!-- ADIM 5: ÖZET VE KAYDET -->
                <p:tab title="5. Özet ve Kaydet" titleStyle="font-weight:bold">

                    <div class="tab-panel">
                        <h3 style="color: #2c3e50; margin-bottom: 20px;">
                            <i class="pi pi-check-circle"></i> Rapor Modülü Özeti
                        </h3>

                        <!-- ÖZET PANELİ -->
                        <p:panel header="Rapor Modülü Özeti" style="margin-bottom: 20px;">

                            <p:panelGrid columns="2" style="width: 100%">
                                <strong>Modül Adı:</strong>
                                <strong style="color: #2c3e50;">#{raporYonetimController.yeniRaporModul.ad}</strong>

                                <strong>Ana Entity:</strong>
                                <code>#{raporYonetimController.yeniRaporModul.anaEntity}</code>

                                <strong>Açıklama:</strong>
                                <span>#{raporYonetimController.yeniRaporModul.aciklama}</span>

                                <strong>Toplam Kolon:</strong>
                                <p:badge value="#{raporYonetimController.yeniKolonlar.size()}"
                                         severity="info"/>

                                <strong>Toplam Parametre:</strong>
                                <p:badge value="#{raporYonetimController.yeniParametreler.size()}"
                                         severity="info"/>

                                <strong>Toplam Entity Bağlantısı:</strong>
                                <p:badge value="#{raporYonetimController.yeniEntityBaglantilari.size()}"
                                         severity="info"/>
                            </p:panelGrid>

                        </p:panel>

                        <!-- KOLON ÖZETİ -->
                        <p:accordionPanel multiple="true" style="margin-bottom: 20px;">

                            <p:tab title="Kolonlar (#{raporYonetimController.yeniKolonlar.size()})">
                                <p:dataTable value="#{raporYonetimController.yeniKolonlar}"
                                             var="kolon"
                                             emptyMessage="Kolon tanımlanmamış">
                                    <p:column headerText="Alan">#{kolon.alanAdi}</p:column>
                                    <p:column headerText="Görünür Ad">#{kolon.gorunurAdi}</p:column>
                                    <p:column headerText="Tip">#{kolon.veriTipi}</p:column>
                                </p:dataTable>
                            </p:tab>

                            <p:tab title="Parametreler (#{raporYonetimController.yeniParametreler.size()})">
                                <p:dataTable value="#{raporYonetimController.yeniParametreler}"
                                             var="param"
                                             emptyMessage="Parametre tanımlanmamış">
                                    <p:column headerText="Parametre">#{param.parametreAdi}</p:column>
                                    <p:column headerText="Görünür Ad">#{param.gorunurAdi}</p:column>
                                    <p:column headerText="Tip">#{param.veriTipi}</p:column>
                                    <p:column headerText="Zorunlu">#{param.zorunlu ? 'Evet' : 'Hayır'}</p:column>
                                </p:dataTable>
                            </p:tab>

                            <p:tab title="Entity Bağlantıları (#{raporYonetimController.yeniEntityBaglantilari.size()})">
                                <p:dataTable value="#{raporYonetimController.yeniEntityBaglantilari}"
                                             var="baglanti"
                                             emptyMessage="Entity bağlantısı tanımlanmamış">
                                    <p:column headerText="Entity">#{baglanti.entityAdi}</p:column>
                                    <p:column headerText="Class">#{baglanti.entityClass}</p:column>
                                    <p:column headerText="Join Tipi">#{baglanti.joinTipi}</p:column>
                                    <p:column headerText="Koşul">
                                        <small><code>#{baglanti.joinKosulu}</code></small>
                                    </p:column>
                                </p:dataTable>
                            </p:tab>

                        </p:accordionPanel>

                        <!-- KAYDET BUTONLARI -->
                        <div style="text-align: center; margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee;">

                            <p:commandButton value="Rapor Modülünü Kaydet"
                                             action="#{raporYonetimController.yeniRaporModulKaydet}"
                                             update=":mainForm,:growl"
                                             oncomplete="if(!args.validationFailed) { PF('yeniRaporDialog').hide(); }"
                                             icon="pi pi-save"
                                             styleClass="ui-button-success"
                                             style="font-size: 16px; padding: 10px 30px;"/>

                            <p:commandButton value="← Geri"
                                             icon="pi pi-arrow-left"
                                             update="@form"
                                             oncomplete="PF('wizard').prev()"
                                             styleClass="ui-button-secondary"/>

                            <p:commandButton value="İptal"
                                             onclick="PF('yeniRaporDialog').hide()"
                                             styleClass="ui-button-danger"/>

                        </div>

                    </div>

                </p:tab>
                <f:facet name="footer">
                    <p:commandButton value="Geri"
                                     process="@this"
                                     update="myWizard" />

                    <p:commandButton value="İleri"
                                     process="@this"
                                     update="myWizard" />
                </f:facet>
            </p:wizard>

        </h:form>


    </p:dialog>


</h:body>

</html>
